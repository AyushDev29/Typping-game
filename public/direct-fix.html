<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Direct Fix - Create Admin Now</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <div class="container">
        <div class="auth-card">
            <h1>üî• DIRECT FIX - CREATE ADMIN NOW</h1>
            <p class="subtitle">This will directly create everything needed</p>
            
            <div id="status" style="background: #000; color: #0f0; padding: 15px; border-radius: 5px; font-family: monospace; height: 200px; overflow-y: auto; margin: 20px 0;"></div>
            
            <button id="fixEverything" class="btn btn-danger btn-large">üöÄ FIX EVERYTHING NOW</button>
            
            <div style="margin-top: 20px;">
                <a href="login.html" class="btn btn-primary">Go to Login</a>
                <a href="admin/dashboard.html" class="btn btn-success">Go to Dashboard</a>
            </div>
        </div>
    </div>

    <script type="module">
        import { auth, db } from './js/firebase.js';
        import { createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { collection, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        const statusDiv = document.getElementById('status');
        
        function log(message) {
            console.log(message);
            statusDiv.innerHTML += message + '\n';
            statusDiv.scrollTop = statusDiv.scrollHeight;
        }
        
        document.getElementById('fixEverything').addEventListener('click', async () => {
            log('üöÄ STARTING DIRECT FIX...');
            
            try {
                // Step 1: Create admin in admins collection
                log('Step 1: Creating admin in Firestore...');
                const adminRef = doc(collection(db, 'admins'));
                await setDoc(adminRef, {
                    email: 'admin2006@gmail.com'
                });
                log('‚úÖ Admin created in admins collection');
                
                // Step 2: Try to register user (if not exists)
                log('Step 2: Creating user account...');
                let user;
                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, 'admin2006@gmail.com', 'admin123');
                    user = userCredential.user;
                    log('‚úÖ New user account created');
                } catch (error) {
                    if (error.code === 'auth/email-already-in-use') {
                        log('‚ÑπÔ∏è User account already exists, logging in...');
                        const loginCredential = await signInWithEmailAndPassword(auth, 'admin2006@gmail.com', 'admin123');
                        user = loginCredential.user;
                        log('‚úÖ Logged in existing user');
                    } else {
                        throw error;
                    }
                }
                
                // Step 3: Create user document in users collection
                log('Step 3: Creating user document in Firestore...');
                const userRef = doc(db, 'users', user.uid);
                const userData = {
                    uid: user.uid,
                    email: 'admin2006@gmail.com',
                    name: 'Admin User',
                    role: 'admin',
                    createdAt: serverTimestamp(),
                    lastLoginAt: serverTimestamp(),
                    loginCount: 1,
                    status: 'active',
                    updatedAt: serverTimestamp()
                };
                
                await setDoc(userRef, userData);
                log('‚úÖ User document created in users collection');
                
                // Step 4: Store in session
                log('Step 4: Storing in session...');
                sessionStorage.setItem('user', JSON.stringify({
                    uid: user.uid,
                    email: 'admin2006@gmail.com',
                    name: 'Admin User',
                    role: 'admin'
                }));
                log('‚úÖ Session storage updated');
                
                log('');
                log('üéâ SUCCESS! Everything is now set up:');
                log('   ‚úÖ Admin entry in admins collection');
                log('   ‚úÖ User account in Firebase Auth');
                log('   ‚úÖ User document in users collection');
                log('   ‚úÖ Session storage updated');
                log('   ‚úÖ Role: admin');
                log('');
                log('You can now:');
                log('1. Click "Go to Login" and login with:');
                log('   Email: admin2006@gmail.com');
                log('   Password: admin123');
                log('2. Or click "Go to Dashboard" directly');
                
            } catch (error) {
                log('‚ùå ERROR: ' + error.message);
                log('Error details: ' + JSON.stringify(error, null, 2));
            }
        });
        
        log('Ready to fix everything...');
        log('Click the button to create admin account and data.');
    </script>
</body>
</html>